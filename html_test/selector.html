<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    div {
      width: 100px;
      height: 100px;
      background: red;
    }

    [data-a="123"] {
      width: 200px;
      height: 300px;
      background: blue;
    }
  </style>
</head>

<body>
  <div data-a="123"></div>

  <script>
    function myNew(fn, ...args) {
      let obj = {};
      Object.setPrototypeOf(obj, fn.prototype);
      let result = fn.apply(obj, args);
      return result instanceof Object ? result : obj;
    }

    function person(name) {
      this.name = name;
      this.sayName = function () {
        console.log(this.name)
      }
    }
    let p = myNew(person, 'ligang')
    p.sayName()
    console.log(p)

    // promiseall
    function myPromiseAll(promiseList) {
      return new Promise((resolve, reject) => {
        let sucessNum = 0
        let resultAry = []
        let len = promiseList.length
        for (let i = 0; i < len; i++) {
          promiseList[i].then(data => {
            sucessNum++
            resultAry[i] = data
            if (sucessNum === len) {
              return resolve(resultAry);
            }
          }, (err) => {
            return reject('失败了', promiseList[i])
          })
        }

      })
    }

    let p1 = Promise.resolve(1)
    let p2 = Promise.resolve(2)
    let p3 = Promise.resolve(3)
    myPromiseAll([p1, p2, p3]).then(data => {
      console.log(data)
    }, err => {
      console.log(err)
    })

    // 3 2 1
    function task(timer, light) {
      return new Promise((resolve, reject) => {
        setTimeout(() => {
          console.log(light)
          resolve()
        }, timer)
      })
    }
    // const step = () => {
    //   task(3000, 'red')
    //     .then(() => task(2000, 'green'))
    //     .then(() => task(1000, 'yellow'))
    //     .then(step)
    // }
    // step()

    const step = async () => {
      await task(3000, 'red')
      await task(2000, 'green')
      await task(1000, 'yellow')
      await step()
    }
    step()
  </script>
</body>

</html>